<extend name="public/template" />
<block name="headerlink">
	<!-- BEGIN PAGE LEVEL PLUGIN STYLES -->
	<link href="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css"/>
	<link href="__PUBLIC__/metronic3_7/assets/global/plugins/fullcalendar/fullcalendar.min.css" rel="stylesheet" type="text/css"/>
	<link href="__PUBLIC__/metronic3_7/assets/global/plugins/jqvmap/jqvmap/jqvmap.css" rel="stylesheet" type="text/css"/>
	<!-- END PAGE LEVEL PLUGIN STYLES -->
	<!-- BEGIN PAGE STYLES -->
	<link href="__PUBLIC__/metronic3_7/assets/admin/pages/css/tasks.css" rel="stylesheet" type="text/css"/>
	<!-- END PAGE STYLES -->
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="__PUBLIC__/metronic3_7/assets/admin/layout/scripts/tooltip.js"></script>
	<link href="__PUBLIC__/metronic3_7/assets/admin/layout/css/custom.css" rel="stylesheet" type="text/css"/>
</block>
<block name="siderbarmenu">
	<ul class="page-sidebar-menu " data-keep-expanded="false" data-auto-scroll="true" data-slide-speed="200">
		<!-- DOC: To remove the sidebar toggler from the sidebar you just need to completely remove the below "sidebar-toggler-wrapper" LI element -->
		<li class="sidebar-toggler-wrapper">
			<!-- BEGIN SIDEBAR TOGGLER BUTTON -->
			<div class="sidebar-toggler">
			</div>
			<!-- END SIDEBAR TOGGLER BUTTON -->
		</li>
		<!-- DOC: To remove the search box from the sidebar you just need to completely remove the below "sidebar-search-wrapper" LI element -->
		<li class="sidebar-search-wrapper">
			<!-- BEGIN RESPONSIVE QUICK SEARCH FORM -->
			<!-- DOC: Apply "sidebar-search-bordered" class the below search form to have bordered search box -->
			<!-- DOC: Apply "sidebar-search-bordered sidebar-search-solid" class the below search form to have bordered & solid search box -->
			<form class="sidebar-search " action="extra_search.html" method="POST">
				<a href="javascript:;" class="remove">
				<i class="icon-close"></i>
				</a>
				<div class="input-group">
					<input type="text" class="form-control" placeholder="Search...">
					<span class="input-group-btn">
					<a href="javascript:;" class="btn submit"><i class="icon-magnifier"></i></a>
					</span>
				</div>
			</form>
			<!-- END RESPONSIVE QUICK SEARCH FORM -->
		</li>
		<li class="start active open">
			<a href="javascript:;">
			<i class="icon-home"></i>
			<span class="title">Dashboard</span>
			<span class="selected"></span>
			<span class="arrow open"></span>
			</a>
			<ul class="sub-menu">
				<li class="active">
					<a href="{:U('Dashboard/index');}">
					<i class="icon-bar-chart"></i>
					Default Dashboard</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="javascript:;">
			<i class="icon-basket"></i>
			<span class="title">eCommerce</span>
			<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="ecommerce_index.html">
					<i class="icon-home"></i>
					Dashboard</a>
				</li>
				<li>
					<a href="{:U('Order/orderlist_ongoing');}">
					<i class="icon-bell"></i>
					<span class="badge badge-danger">{$cin}</span>
					Orders Ongoing</a>
				</li>
				<li>
					<a href="{:U('Order/orderlist?flag=3');}">
					<i class="icon-basket"></i>
					Orders All</a>
				</li>
				<li>
					<a href="#">
						<i class="icon-bar-chart"></i>
						Data Analysis
					</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="javascript:;">
				<i class="fa fa-code"></i>
				<span class="title">Workers</span>
				<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="ecommerce_index.html">
					<i class="icon-home"></i>
					Dashboard</a>
				</li>
				<li>
					<a href="{:U('Worker/workerlist');}">
						<i class="icon-basket"></i>
						Workers
					</a>
				</li>
				<li>
					<a href="#">
						<i class="icon-bar-chart"></i>
						Data Analysis
					</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="javascript:;">
			<i class="icon-settings"></i>
			<span class="title">Configuration</span>
			<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="{:U('Configure/exchangelist');}">
						Exchange Rate
					</a>
				</li>
				<li>
					<a href="form_controls_md.html">
						Technologies Conf
					</a>
				</li>

			</ul>
		</li>
		<li>
			<a href="javascript:;">
			<i class="icon-settings"></i>
			<span class="title">Configuration</span>
			<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="form_controls.html">
						Exchange Rate
					</a>
				</li>
				<li>
					<a href="form_controls_md.html">
						Technologies Conf
					</a>
				</li>

			</ul>
		</li>
	</ul>
</block>
<block name="container">
	<div class="page-content">
			<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<!-- BEGIN STYLE CUSTOMIZER -->
			<!-- END STYLE CUSTOMIZER -->
			<!-- BEGIN PAGE HEADER-->
			<div class="page-bar">
				<ul class="page-breadcrumb">
					<li>
						<i class="fa fa-home"></i>
						<a href="index.html">Home</a>
						<i class="fa fa-angle-right"></i>
					</li>
					<li>
						<a href="#">Dashboard</a>
					</li>
				</ul>
			</div>
			<h3 class="page-title">
			Dashboard <small>reports & statistics</small>
			</h3>
				<!-- END PAGE HEADER-->
				<!-- BEGIN DASHBOARD STATS -->
				<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
					<div class="dashboard-stat blue-madison">
						<div class="visual">
							<i class="fa fa-comments"></i>
						</div>
						<div class="details">
							<div class="number">
								 {$revenues} <i class="fa fa-cny"></i>
							</div>
							<div class="desc">
								 Revenues
							</div>
						</div>
						<a class="more" href="javascript:;">
						View more <i class="m-icon-swapright m-icon-white"></i>
						</a>
					</div>
				</div>
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
					<div class="dashboard-stat red-intense">
						<div class="visual">
							<i class="fa fa-bar-chart-o"></i>
						</div>
						<div class="details">
							<div class="number">
								 {$profit}<i class="fa fa-cny"></i>
							</div>
							<div class="desc">
								 Profit
							</div>
						</div>
						<a class="more" href="javascript:;">
						View more <i class="m-icon-swapright m-icon-white"></i>
						</a>
					</div>
				</div>
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
					<div class="dashboard-stat green-haze">
						<div class="visual">
							<i class="fa fa-shopping-cart"></i>
						</div>
						<div class="details">
							<div class="number">
								 {$cin}
							</div>
							<div class="desc">
								 Ongoing
							</div>
						</div>
						<a class="more" href="javascript:;">
						View more <i class="m-icon-swapright m-icon-white"></i>
						</a>
					</div>
				</div>
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
					<div class="dashboard-stat purple-plum">
						<div class="visual">
							<i class="fa fa-globe"></i>
						</div>
						<div class="details">
							<div class="number">
								 {$ongoingprofit}<i class="fa fa-cny"></i>
							</div>
							<div class="desc">
								 Estimat
							</div>
						</div>
						<a class="more" href="javascript:;">
						View more <i class="m-icon-swapright m-icon-white"></i>
						</a>
					</div>
				</div>
			</div>
				<!-- END DASHBOARD STATS -->
				<div class="clearfix">
			</div>
				<div class="row">
						<div class="col-md-6 col-sm-6">
						<!-- BEGIN PORTLET-->
						<div class="portlet light ">
							<div class="portlet-title">
								<div class="caption">
									<i class="icon-bar-chart font-green-sharp hide"></i>
									<span class="caption-subject font-green-sharp bold uppercase">Global statistic</span>
									<span class="caption-helper">global statistic...</span>
								</div>
							</div>
							<div class="portlet-body">
								<div class="portlet-body">
									<div class="row static-info">
										<div class="col-md-5 name">
											 Revenues (all completed):
										</div>
										<div class="col-md-7 value">
											 <i class="fa fa-paper-plane"></i> {$revenues} RMB
										</div>
									</div>
									<foreach name="revenuesarr" item="vo">
										<div class="row static-info">
											<div class="col-md-5 name">
											</div>
											<div class="col-md-7 value">
												 <small><i class="fa fa-check-square-o"></i> {$vo['revenues']} {$vo['moneytype']} </mall><span class="label label-sm label-info"> {$vo['rating']} </span>
											</div>
										</div>
									</foreach>
									<div class="row static-info">
										<div class="col-md-5 name">
											 Profit (all completed):
										</div>
										<div class="col-md-7 value">
											 <i class="fa fa-paper-plane"></i> {$profit} RMB
										</div>
									</div>
									<div class="row static-info">
										<div class="col-md-5 name">
											 Worker Salary (all completed):
										</div>
										<div class="col-md-7 value">
											 <i class="fa fa-paper-plane"></i> {$salary} RMB
										</div>
									</div>
									<div class="row static-info">
										<div class="col-md-5 name">
											 No. completed Orders
										</div>
										<div class="col-md-7 value">
											 <i class="fa fa-paper-plane"></i> {$ordernum}
										</div>
									</div>
									<hr>
									<div class="row static-info">
										<div class="col-md-5 name">
											 Revenues (ongoing):
										</div>
										<div class="col-md-7 value">
											 <i class="fa fa-paper-plane"></i> {$ongoingrevenues} RMB
										</div>
									</div>
									<foreach name="ongoingrevenuesarr" item="vo">
										<div class="row static-info">
											<div class="col-md-5 name">
											</div>
											<div class="col-md-7 value">
												 <small><i class="fa fa-check-square-o"></i> {$vo['revenues']} {$vo['moneytype']} </mall><span class="label label-sm label-info"> {$vo['rating']} </span>
											</div>
										</div>
									</foreach>
									<div class="row static-info">
										<div class="col-md-5 name">
											 Profit (ongoing):
										</div>
										<div class="col-md-7 value">
											 <i class="fa fa-paper-plane"></i> {$ongoingprofit} RMB
										</div>
									</div>
									<div class="row static-info">
										<div class="col-md-5 name">
											 Worker Salary (ongoing):
										</div>
										<div class="col-md-7 value">
											 <i class="fa fa-paper-plane"></i> {$ongoingsalary} RMB
										</div>
									</div>
									<div class="row static-info">
										<div class="col-md-5 name">
											 No. ongoing Orders
										</div>
										<div class="col-md-7 value">
											 <i class="fa fa-paper-plane"></i> {$cin}
										</div>
									</div>
									<hr>
								</div>
							</div>
						</div>
						<!-- END PORTLET-->
					</div>
						<div class="col-md-6 col-sm-6">
						<!-- BEGIN PORTLET-->
						<div class="portlet light ">
							<div class="portlet-title">
								<div class="caption">
									<i class="icon-share font-red-sunglo hide"></i>
									<span class="caption-subject font-red-sunglo bold uppercase">Day Analysis</span>
									<span class="caption-helper">Day Section Analysis...</span>
								</div>
							</div>
							<div class="portlet-body">
								<div class="row">
									<div class="col-md-12 col-sm-12">
										<div class="form-group">
											<div class="col-md-4 col-sm-12">
												<div class="input-group date form_meridian_date" data-date="2012-12-21T15:25:00Z">
													<input name="daysearchinput" type="text" size="10" class="form-control input-inline" placeholder="Day" value="{$today}" readonly>
													<span class="input-group-btn">
													<button class="btn default date-set" type="button"><i class="fa fa-calendar"></i></button>
													</span>
												</div>
												<!-- /input-group -->
											</div>
											<div class="col-md-4 col-sm-12">
												<button class="btn yellow table-group-action-submit" id="daysearchbtn"><i class="fa fa-search"></i></button>
											</div>
										</div>
									</div>
								</div>
									<div class="portlet-body">
										<div class="portlet-body">
											<div class="row static-info">
												<div class="col-md-5 name">
													 Revenues:
												</div>
												<div class="col-md-7 value">
													 <i class="fa fa-paper-plane" ></i><span id="dayrevenues"></span>
												</div>
											</div>
											<div id="daydatalist">
											</div>
											<div class="row static-info">
												<div class="col-md-5 name">
													 Profit :
												</div>
												<div class="col-md-7 value">
													 <i class="fa fa-paper-plane"></i>  <span id="dayprofit"></span>
												</div>
											</div>
											<div class="row static-info">
												<div class="col-md-5 name">
													 Worker Salary :
												</div>
												<div class="col-md-7 value">
													 <i class="fa fa-paper-plane"></i> <span id="daysalary"></span>
												</div>
											</div>
											<hr>
										</div>
									</div>
								</div>

							</div>
						</div>
						<!-- END PORTLET-->
						<div class="col-md-12 col-sm-12">
							<div class="portlet box green">
						<div class="portlet-title">
							<div class="caption">
								<i class="fa fa-gift"></i>Tracking Curves
							</div>
							<div class="tools">
								<a href="javascript:;" class="collapse" data-original-title="" title="">
								</a>
								<a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title="">
								</a>
								<a href="javascript:;" class="reload" data-original-title="" title="">
								</a>
								<a href="javascript:;" class="remove" data-original-title="" title="">
								</a>
							</div>
						</div>
						<div class="portlet-body form">
							<div class="row">
								<div class="col-md-12 col-sm-12">
									<div class="form-group">
										<div class="col-md-3 col-sm-12">
											<div class="input-group input-medium date date-picker" data-date="{$todaymonth}" data-date-format="yyyy-mm" data-date-viewmode="years" data-date-minviewmode="months">
												<input type="text" class="form-control" name="monthsearchinput" width="80%" value="{$todaymonth}" readonly="">
												<span class="input-group-btn">
												<button class="btn default" type="button"><i class="fa fa-calendar"></i></button>
												</span>
											</div>
											<!-- /input-group -->
										</div>
										<div class="col-md-1 col-sm-12">
											<button class="btn yellow table-group-action-submit" id="monthsearchbtn"><i class="fa fa-search"></i></button>
										</div>
										<div class="col-md-8 col-sm-12">
											<i class="fa fa-search" ></i> Salary/mon: <span id="monthsalarysum"></span>
											<i class="fa fa-search" ></i> Profit/mon: <span id="monthprofitsum"></span>
											<i class="fa fa-search" ></i> Revenues/mon: <span id="monthrevenuessum"></span>
										</div>
									</div>
								</div>
							<div id="chart_month" class="chart" style="padding: 0px; position: relative;width:100%;height: 400px;">
							</div>
					</div>

						</div>
				</div>
			</div>
			<div class="clearfix">
			</div>
		</div>
</block>
<block name="footscript">
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/select2/select2.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/datatables/media/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
	<!-- END PAGE LEVEL PLUGINS -->
	<!-- BEGIN PAGE LEVEL SCRIPTS -->
	<!-- BEGIN PAGE LEVEL PLUGINS -->
<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/clockface/js/clockface.js"></script>
<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-daterangepicker/moment.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-daterangepicker/daterangepicker.js"></script>
<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>
<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="__PUBLIC__/metronic3_7/assets/global/scripts/metronic.js" type="text/javascript"></script>
<script src="__PUBLIC__/metronic3_7/assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
<script src="__PUBLIC__/metronic3_7/assets/admin/pages/scripts/components-pickers.js"></script>
<script src="__PUBLIC__/metronic3_7/assets/global/scripts/metronic.js" type="text/javascript"></script>
<script src="__PUBLIC__/metronic3_7/assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
<script src="__PUBLIC__/metronic3_7/assets/admin/layout/scripts/quick-sidebar.js" type="text/javascript"></script>
<script src="__PUBLIC__/metronic3_7/assets/admin/layout/scripts/demo.js" type="text/javascript"></script>
<script src="__PUBLIC__/metronic3_7/assets/admin/pages/scripts/components-pickers.js"></script>

	<!-- END PAGE LEVEL SCRIPTS -->
	<script>
		jQuery(document).ready(function() {
			// initiate layout and plugins
			Metronic.init(); // init metronic core components
			Layout.init(); // init current layout
			Demo.init(); // init demo features
			ComponentsPickers.init();
        });
		/* date data */
		function get_datedata_query(day){
			var data = {};
			data.daytime = day;
			var url='__URL__/getDayData';
			$.ajax({
				type:"post",
				url:url,
				data:data,
				dataType:"json",
				success: function aa(data) {
					  //showstorelist(data.stores);
						//console.log(data);
						showDayData(data);
				}
			});
		}
		function showDayData(data){
			$("#dayrevenues").html("");
			$("#daydatalist").html("");

			$("#dayrevenues").text("  " + data.today_revenues + " RMB");
			if(data.today_alldata != null){
				for(var i=0;i< data.today_alldata.length;i++){
					var cell='<div class="row static-info"><div class="col-md-5 name"></div><div class="col-md-7 value"><small><i class="fa fa-check-square-o"></i> ' + data['today_alldata'][i].revenues + " " + data['today_alldata'][i].moneytype +  '</small><span class="label label-sm label-info"> {$vo['rating']} </span></div></div>';
					$("#daydatalist").append(cell);
				}
			}

			$("#dayprofit").text("  " + data.today_profit + " RMB");
			if(data.today_salary == null){
				data.today_salary = 0;
			}
			$("#daysalary").text("  " + data.today_salary + " RMB");
		}
		var day  = $("input[name='daysearchinput']").val()
		get_datedata_query(day);
		$("#daysearchbtn").click(function(){
			var data = {};
			var day = $("input[name='daysearchinput']").val();
			get_datedata_query(day);
			//console.log(day);

		});
		/* month data  */
		function get_monthdata_query(day){
			var data = {};
			data.daytime = day;
			var url='__URL__/getMonthData';
			$.ajax({
				type:"post",
				url:url,
				data:data,
				dataType:"json",
				success: function aa(data) {
					  //showstorelist(data.stores);
						console.log(data);
						drawProfitBar(data.datas);
						$("#monthsalarysum").text("  " + data.salarysum + " RMB");
						$("#monthprofitsum").text("  " + data.profitsum + " RMB");
						$("#monthrevenuessum").text("  " + data.revenuesum + " RMB");
						//showDayData(data);
				}
			});
		}
		var month = $("input[name='monthsearchinput']").val();
		get_monthdata_query(month);
		$("#monthsearchbtn").click(function(){
			var data = {};
			var month = $("input[name='monthsearchinput']").val();
			get_monthdata_query(month);
			//console.log(day);
		});
		/* get year */
		function get_yeardata_query(day){
			var data = {};
			data.daytime = day;
			var url='__URL__/getYearData';
			$.ajax({
				type:"post",
				url:url,
				data:data,
				dataType:"json",
				success: function aa(data) {
					  //showstorelist(data.stores);
						console.log(data);
						//drawProfitBar(data.datas);
						//$("#monthsalarysum").text("  " + data.salarysum + " RMB");
						//$("#monthprofitsum").text("  " + data.profitsum + " RMB");
						//$("#monthrevenuessum").text("  " + data.revenuesum + " RMB");
						//showDayData(data);
				}
			});
		}
		get_yeardata_query('2018');

		</script>
		<script>
			/*
			var data = [
    {name:'A',count:64,description:"This is column A!"},
    {name:'B',count:32,description:"This is column B!"},
    {name:'C',count:16,description:"This is column C!"},
    {name:'D',count:8,description:"This is column D!"},
    {name:'E',count:4,description:"This is column E!"},
    {name:'F',count:2,description:"This is column F!"},
];*/
function drawProfitBar(data){

	// Draw a basic bar chart
	var wd = $(chart_month).width();
	var wh = $(chart_month).height();
	var margin = {top:20, left:50, bottom:70, right:20};
	var height = wh - margin.top - margin.bottom,
	    width = wd - margin.left - margin.right;
  $("#chart_month").html("");
	var svg = d3.select("#chart_month")
	        .append("svg")
	        .attr("height", height + margin.top + margin.bottom)
	        .attr("width", width + margin.left + margin.right)
	        .style("cursor","default")
	        .append("g")
	        .attr("transform","translate(" + margin.left + "," + margin.top + ")");

	var x = d3.scaleBand()
	    .domain(data.map(function(d) { return d.createday;}))
	    .range([0,width])
	    .padding(.1);
	var flagv = Math.max.apply(Math,data.map(function(o){return o.profit;}))
	var y = d3.scaleLinear()
	    .domain([0,flagv])
	    .range([height,0]);

	var color = d3.scaleOrdinal(d3.schemeCategory10)
	    .domain(x.domain())


	var tooltip = d3.tooltip() // returns the tooltip function
	    .extent([[0,0],[width,height]]) // tells the tooltip how much area it has to work with
	    .tips(["createday","profit","salary","revenuearray"],["CreateDate: ","Profit: ","Salary: ","Revenue: "]) // tells the tooltip which properties to display in the tip and what to label thme
	    .fontSize(12) // sets the font size for the tooltip
	    .padding([8,4]) // sets the amount of padding in the tooltip rectangle
	    .margin([10,10]); // set the distance H and V to keep the tooltip from the mouse pointer

	svg.selectAll(".bar")
	    .data(data)
	    .enter()
	    .append("rect")
	    .attr("x", function(d) { return x(d.createday)})
	    .attr("y", function(d) { return y(d.salary)})
	    .attr("width", x.bandwidth())
	    .attr("height", function(d) { return height - y(d.salary)})
	    .attr("fill", function(d) { return color(d.createday)})
	    .each(tooltip.events); // attaches the tooltips mouseenter/leave/move events but does not overwrite previously attached events

	svg.append("g")
	    .attr("transform", "translate(0," + height + ")")
	    .call(d3.axisBottom(x))
			.selectAll("text")
        .style("text-anchor", "end")
        .attr("dx", "-.8em")
        .attr("dy", ".15em")
        .attr("transform", "rotate(-65)");

	svg.append("g")
	    .call(d3.axisLeft(y));

	svg.call(tooltip) // draws the tooltip;
}

		</script>
</block>
